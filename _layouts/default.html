<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <link rel="icon" type="image/png" href="assets/img/favicon.png">
  <title>{{ site.title | default: site.github.repository_name }} by {{ site.github.owner_name }}</title>

  <link rel="stylesheet" href="{{ '/assets/css/styles.css?v=' | append: site.github.build_revision | relative_url }}">
  <meta name="viewport" content="width=device-width">

  <!-- ✅ Keep ONE ECharts version only (v6) -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@6/dist/echarts.min.js"></script>

  <style>
    .section-title {
      font-weight: bold;
      font-size: 1.5em;
      margin-top: 1.2em;
    }

    .subsection-title {
      font-weight: bold;
      font-size: 1.4em;
      margin-top: 1em;
    }

    .subtitle {
      font-size: 1.6em;
      color: #666;
      margin-top: 10px;
      font-style: italic;
      text-align: center;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.4;
    }

    header {
      display: flex;
      justify-content: center;
      padding: 40px 0;
      background-color: #f8f9fa;
    }

    .header-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      width: 100%;
    }

    .header-content h1 {
      margin-top: 20px;
      margin-bottom: 5px;
      font-size: 2.5em;
    }

    .header-content img {
      margin: 0 auto;
      display: block;
    }

    .plot--img {
      max-width: 100%;
      height: auto;
      display: block;
    }

    #introduction ul {
      display: table;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
      padding-left: 0;
      margin: 20px auto;
    }

    #introduction li {
      font-size: 1.2em;
      margin-bottom: 15px;
      line-height: 1.4;
      color: #333;
    }

    .text-democrat {
      color: #0015BC;
      font-size: 1.1em;
    }

    .text-republican {
      color: #E91D0E;
      font-size: 1.1em;
    }

    .data-list {
      display: table;
      margin: 30px auto;
      font-size: 1.15em;
      line-height: 1.6;
      padding-left: 20px;
    }

    .data-list li {
      margin-bottom: 12px;
      text-align: left;
    }

    .data-list li strong {
      color: #222;
    }

    .clean-stats {
      display: table;
      margin: 30px auto;
      padding-left: 25px;
      list-style-type: disc;
      border-left: none;
    }

    .clean-stats li {
      margin-bottom: 15px;
      font-size: 1.1em;
      line-height: 1.5;
      text-align: left;
    }

    .questions-list {
      display: table;
      margin: 25px auto;
      font-size: 1.25em;
      font-style: italic;
      color: #2c3e50;
      line-height: 1.6;
      padding-left: 20px;
    }

    .questions-list li {
      margin-bottom: 15px;
      text-align: left;
    }
    .split-section {
        display: flex;
        gap: 40px;           /* Espace entre les deux colonnes */
        margin: 40px 0;
        align-items: flex-start; /* Aligne les blocs vers le haut */
    }

    .column {
        flex: 1;             /* Donne la même largeur aux deux colonnes (50/50) */
        min-width: 300px;    /* Sécurité pour le mobile */
    }

    /* Optionnel : ajoute une ligne de séparation au milieu */
    .column:first-child {
        border-right: 1px solid #eee;
        padding-right: 20px;
    }

    /* Sur mobile (écrans < 768px), on empile les colonnes */
    @media (max-width: 768px) {
        .split-section {
            flex-direction: column;
        }
        .column:first-child {
            border-right: none;
            border-bottom: 1px solid #eee;
            padding-right: 0;
            padding-bottom: 20px;
        }
    }




  </style>
</head>

<body>
  <header>
    <div class="header-content">
      <img class="plot--img" src="/ada-vnboys-website/assets/img/youtube_logo.webp">
      <h1>Views as Votes, a Datastory of Political Polarization</h1>
      <p class="subtitle"> Is YouTube a mirror or a distortion of American politics?</p>
    </div>
  </header>

  <nav>
    <ul>
      <li><a href="https://arxiv.org/abs/2012.10378" target="_blank">The YouNiverse Dataset</a></li>
      <li><a href="#grouping">Youtube's Communities</a></li>
      <li><a href="#pageviews">Trends and Polarization</a></li>
      <li><a href="#opinions">Digital vs Reality</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
    </ul>
  </nav>

  <main>
    <section id="introduction" class="justify-text">

      <div class="section-title">Introduction</div>
      <p>
        When America chooses its leader, the whole world holds its breath. Calling it a mere national voting process would be an understatement;
        it is a sacred geopolitical ritual whose consequences are felt across the globe, from Asian stock markets to European frontlines.
        The American presidential election is a quadrennial marathon punctuated by key milestones: the primaries, the national conventions, and the final race between Democrats and Republicans, a duopoly that splits the nation in two distinct colors:
      </p>

      <ul>
        <li><strong class="text-democrat">The Democratic Party:</strong> Generally representing liberal, progressive values.</li>
        <li><strong class="text-republican">The Republican Party:</strong> Generally representing conservative, traditionalist values.</li>
      </ul>

      <p>
        Our study focuses on the elections from 2008 to 2016, a period where the battlefield silently mutated. The epicenter of power shifted from television stages to a dematerialized arena, governed by new and volatile codes. Voters became users; speeches became content.
        Here, we enter what we call the "Attention Democracy." In this digital space, legitimacy is no longer won solely by the vote, but by the obsessive capture of the voter’s mind.
        Our investigation dives deep into YouTube's massive datasets to answer a crucial question: is this new digital arena a faithful mirror of a nation in turmoil, or a distortion machine that polarizes reality and tears apart the social fabric?
      </p>
    </section>

    <section id="research-questions">
      <p>Our investigation seeks to answer three research questions:</p>
      <ul class="questions-list">
        <li>Does YouTube act as a reliable barometer of genuine political interest?</li>
        <li>Does the platform foster polarization or echo chambers?</li>
        <li>Do the sentiments and topics discussed align with public opinion (as measured by polls)?</li>
      </ul>
    </section>

    <section id="channels">
      <div class="section-title">Data Presentation</div>

      <p>
        Before presenting our answers to all these questions, we must first define the boundaries of our arena.
        YouTube is vast and noisy, Top 10 respect moments in football and Minecraft music videos are fun but not what we need; isolating the signal of political discourse requires rigorous filtering. 
      </p>

      <div class="subsection-title">2.1 The Dataset: YouNiverse</div>
      <p>
        Our analysis relies on YouNiverse, a large-scale dataset of English-speaking YouTube metadata.
        This massive archive allows us to observe the platform's evolution during the critical years of
        2008, 2012, and 2016.
        The scale of the data is monumental, establishing the statistical significance of our observations:
      </p>

      <ul class="data-list">
        <li><strong>136,470 Channels:</strong> Filtered for English content, with a minimum of 10k subscribers to ensure relevance.</li>
        <li><strong>73 Million Videos:</strong> Spanning from 2005 to late 2019.</li>
        <li><strong>8.6 Billion Comments:</strong> Representing the voice of the "electorate" (users).</li>
        <li><strong>Metadata Richness:</strong> We utilize titles, tags, view counts, and upload dates to reconstruct the timeline of events.</li>
      </ul>

      <div class="subsection-title">2.2 The Filter: Defining "Political" Content</div>
      <p>
        One of the major challenges in this analysis was distinguishing a political video from the ocean
        of gaming, music, and vlog content. To detect political content, we needed a robust lexicon.
        Initial attempts to build a dictionary using political tracts and manifestos yielded poor results,
        often capturing generic terms unrelated to the specific vernacular of YouTube. Consequently, we
        leveraged Large Language Models (LLMs) to generate a massive, comprehensive vocabulary of political
        terminology, covering the spectrum from legislative terms to campaign slogans.
      </p>

      <div class="subsection-title">2.3 The Focus: Why "News &amp; Politics"?</div>
      <p>
        With our vocabulary in place, we mapped the distribution of political terms across YouTube's
        15 primary categories. Processing the descriptions of 73 million videos was computationally
        prohibitive, so we focused our signal detection on Video Titles and Tags. The goal was to identify
        which category serves as the true "battlefield" for political discourse.
      </p>

      <div id="political-bar-chart" style="width:100%; height:600px;"></div>

      <p>
        As shown in this chart, the category <strong>"News &amp; Politics"</strong> is the clear leader,
        with 42.3% of its videos containing political vocabulary. While "Nonprofits" and "Travel"
        show some density, they lack the volume and specific focus of the News category.
      </p>
    </section>






    <!-- RQ1 -->
    <section id="grouping">
      <h2>Does YouTube act as a reliable barometer of genuine political interest? </h2>
      <p>
        To understand the impact of digital media on democracy, we must first determine if YouTube is 
        simply an entertainment hub or if it has become a serious mirror of national political engagement. 
        In this section, we examine the <strong>growth of political content</strong> over the years and 
        analyze how the platform’s internal "communities" are structured.
          By mapping out the distribution of channels across the political spectrum—from 
          <span class="text-democrat" style="font-weight:bold;">Left</span> to 
          <span class="text-republican" style="font-weight:bold;">Right</span>—we aim to uncover 
          who holds the "share of voice" on the platform. Does the volume of videos and subscriber 
          counts align with real-world voter demographics, or does YouTube create its own 
          <strong>independent political reality</strong>?
      </p>
      <p>
        Looking at the evolution of videos in the <em>News &amp; Politics</em> category, we do not observe a regular
        four-year rhythm aligned with U.S. presidential elections. Instead, political video production follows a clear
        long-term growth trend, with a sharp acceleration after 2018. A few isolated peaks stand out and can be linked to
        major global events, such as the surge in early 2011 following the Fukushima nuclear disaster, which triggered
        widespread political debate well beyond Japan. This evolution also reshapes how attention should be interpreted:
        in the early years of YouTube, political videos were relatively rare, meaning that a single upload could carry
        significant weight, whereas in recent years each video competes within a much denser and more crowded political
        media landscape.
      </p>


      <div id="videos-chart" style="width: 100%; height: 500px; margin: 20px auto;"></div>

      <p>
        The pie chart below shows the political orientation of the channels obtained from the external dataset us_bias.
        We can see that the distribution is fairly even with channels with a centered political orientation representing the largest part.
        This is to be expected as many channels are rather neutral or prefer to stay politically objective. We can see that the proportion of left-oriented vs right-oriented is very similar: 36.3% total on the right and 32.2% on the left.
        Interestingly, there are more Lean Left than Lean Right which suggests that the leftists are somewhat more moderate. The size of the dataset hinders us from drawing any conclusions as it is too small and not representative of all the channels in the News & Politics category.
      </p>
      <div id="political_orientation-chart" style="width: 100%; height: 500px; margin: 20px auto;"></div>

      <p>
        When comparing political orientations based on the number of videos posted throughout the period covered by the dataset, we see greater disparity. Nearly half of the videos are classified as neutral, while those on the left represent one-third of the total analysed, surpassing those on the right by 7.1%. This lead is significant given the large number of videos analysed.
      </p>
      <div id="video_share-chart" style="width: 100%; height: 500px; margin: 20px auto;"></div>

      <p>Who is present on YouTube? We now compare political parties based on subscribers. The pie chart above once again shows an advantage for the Democrats. Indeed, 43.4% of subscribers to channels in the News & Politics category are classified as left-wing, while only 21.1% are right-wing.
        According to our analysis, there are therefore twice as many Democrats as Republicans in this category of channels.</p>
      <div id="sub-chart" style="width: 100%; height: 500px; margin: 20px auto;"></div>

      <div style="text-align: center;">
          <img src="/ada-vnboys-website/assets/img/happy_usa.gif"  
              style="width: 50%; height: auto; max-height: 300px; margin: 40px 0;" 
              alt="USA Celebration">
      </div>


      <p>
        Let us now take a closer look at what happens during the elections covered by our dataset. Choose which election covered you would like to visualize :
      </p>

    <div style="text-align:center; margin-bottom:20px; margin-top:20px;">
      <button onclick="showYear(2008)" style="padding: 12px 24px; font-size: 18px; cursor: pointer;">2008</button>
      <button onclick="showYear(2012)" style="padding: 12px 24px; font-size: 18px; cursor: pointer;">2012</button>
      <button onclick="showYear(2016)" style="padding: 12px 24px; font-size: 18px; cursor: pointer;">2016</button>
    </div>

      <div id="main" style="width: 100%; height: 500px; margin: 20px auto;"></div>

      <p>
        Firstly, there is a significant difference between the distribution of political leanings in these three elections. Indeed, the 2016 elections show a much more varied landscape than the two previous elections, as if YouTube had been a turning point since the 2016 campaign, thus showing a particular interest in the platform. This growing interest is also illustrated by the number of videos posted during these election periods. This number increased tenfold between each election.
        In terms of distribution, the Democratic trend seen so far is once again demonstrated here, with this party leading in all three elections. This lead is particularly marked in 2008 (26.2% vs 7.3%) and in 2016 (40.7% vs 24%). One important question remains: How does this fit with the presidential election results ?
      </p>

      <p>
        On the 4th of November 2008, Barack Obama was elected as president, running as the candidate for the Democratic Party.
        He won by a margin of 7% (popular vote) which is not small and shows the increased popularity of Democrats.
        The distribution of the published videos’ political orientations does show a greater proportion of Leftist (Democrat) videos with respect to the Lean Right.
        However, the center, that is, videos with a more neutral voice, hold by far the greatest share of the videos, with more than two thirds.
        There are only 328 videos published in more than a year and a half for this graph which is a small sample size and therefore the conclusions cannot be final or considered representative of how Youtube is today with that amount of videos being published in a split second.
      </p>
      <div style="text-align: center;">
          <img src="/ada-vnboys-website/assets/img/obama_basketball.jpg"  
              style="width: auto; height: 300px; margin: 40px 0; border-radius: 8px;" 
              alt="Obama">
      </div>
      <p>
        In 2012, Obama was once again elected president and won by a smaller margin with respect to 2008 (4% in the popular vote).
        The “center” portion is by and large the biggest with a fairly even split between the two ends of the political spectrum in the remaining share which echoes the real results.
        However, once again, the share of videos is still quite small and therefore a greater sample size would be needed to confirm these observations.
        Moreover, the number of videos only shows presence of channel subscribing to a certain political orientation and not the activity of the viewers (which would represent the voting population)
      </p>

      <p>
        In 2016, Donald Trump, a Republican, was elected president by the American people.
        However, the popular vote actually went to Hillary Clinton by nearly 3 million votes (2%) so the results were extremely close.
        These elections are known for how polarized they were and how split the public opinion was.
        This is reflected in the pie chart where we see the lowest share of neutral “center” videos and a greater proportion of the other videos.
        The “Left” and “Lean left” is the greatest part of the pie chart, disproportionately so, as the election was a lot closer.
        This shows that the democrats were particularly active on Youtube during the elections. This is only one of the social medium used as a platform to spread their message and only one of many possible campaigning strategies.
      </p>
      <div style="text-align: center;">
          <img src="/ada-vnboys-website/assets/img/trump_dance.gif"  
              style="max-width: 50%; height: auto; margin: 40px 0; object-fit: contain;" 
              alt="Trump">
      </div>

      <p>
        We have now seen who are the political actors on Youtube and the political orientations they express.
        We looked at their following and their activity especially during election period which allows us to get a picture of what the relationship between Youtube and U.S Politics looks like.
        This picture is more of a snapshot as the number of channels used is only a small fraction of the total number of channels in the News & Politics category but we believe it is fairly representative as it shows the most important channels.
        However, it will be useful for us in order to set the scene and compare it with the activity of the viewers.
      </p>
    </section>










    <!-- RQ2 -->
    <section id="pageviews">
      <h2>Does the platform foster polarization or echo chambers?</h2>

      <p>We've looked at who are the CHANNELS that define the political landscape, now we will look at who are the VIEWERS. In an era of algorithm-driven content, there is a widespread concern that people are increasingly exposed only to viewpoints they already agree with, leading to more fragmented and polarized "echo chambers." We will attempt to empirically investigate this phenomenon on YouTube.</p>
      <p>We move beyond individual videos to identify large-scale "communities" of content defined by viewers themselves—by analyzing which videos are commented on by the same groups of people. This approach reveals the thematic and political contours of the YouTube landscape, showing which conversations are central, which are niche, and how much they interact.</p>

      <div style="text-align:center; margin-bottom:10px;">
        <button onclick="showRq2Year(2014)">2014</button>
        <button onclick="showRq2Year(2015)">2015</button>
        <button onclick="showRq2Year(2016)">2016</button>
        <button onclick="showRq2Year(2017)">2017</button>
        <button onclick="showRq2Year(2018)">2018</button>
        <button onclick="showRq2Year(2019)">2019</button>
      </div>

      <div id="rq2-content-wrapper">
        {% for year in (2014..2019) %}
        <div id="rq2-{{ year }}" class="rq2-year-content" style="display:none;">
          <h3 style="text-align: center; font-size: 1.5em; margin-bottom: 20px;">Analysis for {{ year }}</h3>

          <div class="analysis-item">
            <h4>Political Makeup of Communities</h4>
            <p>This chart provides a visual breakdown of the political leanings within each identified community. Each bar represents a community, and the colored segments show the proportion of videos from different political biases (Left, Center, Right). This allows us to see if a community is politically homogeneous (an echo chamber) or diverse.</p>
            <img src="/ada-vnboys-website/assets/{{ year }}/bias_composition_plot.png" alt="Political Bias Composition for {{ year }}" style="width:100%; max-width:800px; display:block; margin:auto;">
            <p> Notice anything? At first, in 2014 and 2015, the communities are rather well distributed and center is the most present political orientation. Starting from 2016 and onwards, the communtiies become a lot more homogeneous and more importantly, more red and blue, respectively. This reflects the distribution of videos posted throughout the election periods where in 2016 we saw a more politically split distirbution. </p>
          </div>

          <div class="analysis-item">
            <h4>Top Discussion Topics</h4>
            <p>This chart displays the top three most discussed themes for each community, such as "Economy & jobs" or "Foreign policy." It helps define the identity of each conversation bubble by showing what issues were most important to them during the year. Hover over the bars for more details.</p>
            <iframe src="/ada-vnboys-website/assets/{{ year }}/top_themes_plot.html" width="100%" height="500" style="border:1px solid #ccc; margin:auto; display:block;"></iframe>
          </div>

          <div class="analysis-item">
            <h4>Echo Chamber Diagnostics</h4>
            <p>This figure diagnoses the "echo chamber" phenomenon. The histogram on the left shows how many videos are "echo-prone" (seen by one community) versus "cross-audience" (seen by many). The bar chart on the right summarizes how many connections are within the same community versus across different communities, indicating how siloed the network is.</p>
            <img src="/ada-vnboys-website/assets/{{ year }}/echo_chamber_diagnostics.png" alt="Echo Chamber Diagnostics for {{ year }}" style="width:100%; max-width:800px; display:block; margin:auto;">
          </div>
          
          <div class="analysis-item">
            <h4>Monthly Echo Chamber Trends</h4>
            <p>This plot shows how the echo chamber metrics evolved month-to-month throughout the year, revealing whether the platform became more or less polarized over time.</p>
            <img src="/ada-vnboys-website/assets/{{ year }}/echo_chamber_diagnostics_monthly.png" alt="Monthly Echo Chamber Diagnostics for {{ year }}" style="width:100%; max-width:800px; display:block; margin:auto;">
          </div>

          <div class="analysis-item">
            <h4>Community Activity Over Time</h4>
            <p>This line chart tracks the monthly activity (number of comments) for each community. Each colored line represents a community, allowing us to see which conversation clusters grew in engagement and which faded in response to major news events throughout the year.</p>
            <iframe src="/ada-vnboys-website/assets/{{ year }}/temporal_evolution_M_plot.html" width="100%" height="500" style="border:1px solid #ccc; margin:auto; display:block;"></iframe>
          </div>

          <div class="analysis-item">
            <h4>What Defines a Community?</h4>
            <p>This plot shows which factors were most important for defining a community's identity and political leaning. Longer bars indicate more influential features, such as specific themes (e.g., "Immigration") or video properties (e.g., number of connections).</p>
            <img src="/ada-vnboys-website/assets/{{ year }}/logistic_feature_importance.png" alt="Feature Importance for {{ year }}" style="width:100%; max-width:800px; display:block; margin:auto;">
          </div>
          
        </div>
        {% endfor %}
      </div>
    </section>

    <script>
      function showRq2Year(year) {
        // Hide all year content
        var yearContents = document.querySelectorAll('.rq2-year-content');
        yearContents.forEach(function(div) {
          div.style.display = 'none';
        });

        // Show the selected year's content
        var selectedYearDiv = document.getElementById('rq2-' + year);
        if (selectedYearDiv) {
          selectedYearDiv.style.display = 'block';
        }
      }
      // Show the first year by default
      document.addEventListener('DOMContentLoaded', function() {
        showRq2Year(2019);
      });
    </script>




    <!-- RQ3 -->
<section id="opinions">
    <h2>Do the sentiments and topics discussed align with public opinion?</h2>

    <p>
    In the previous sections, we identified who the actors are and how they cluster into communities. 
    But to fully understand the "Attention Democracy," we must examine the substance of the conversation. 
    Is YouTube a faithful mirror of American political concerns, or does the platform’s architecture distort the discourse?

    This section deconstructs the content itself. 
    We move from raw keywords to hidden thematic structures, and finally, we measure what truly drives viewership : facts or feelings.
    </p>

    <h3>The Surface : Names and Keywords</h3>

    <p>We first look at the raw signals : the names and topic of the video tags .</p>

    <h4>
      Interactive Tracker: The Personalities Politics is often personified.
      Use the tool below to track the popularity of specific political figures over time.
    </h4>

      <div style="max-width: 1100px; margin: 0 auto;">
        

        <p style="margin:6px 0 12px 0; color:#444;">
          From a political perspective, the interactive graph allows for comparison between different candidates during elections or otherwise.
          Enter <b>3–4 names</b> (comma-separated). You can type <b>last names</b> only (e.g., <i>Biden</i>) and we will match them to full names (e.g., <i>Joe Biden</i>).
          Dates are pre-filled; adjust them if needed, then click <b>Plot</b>.
        </p>

        <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:end; margin: 10px 0;">
          <div>
            <label>Names (3–4, comma-separated)</label><br>
            <input id="words" type="text" value="Clinton, Trump, Obama" style="width:320px;">
          </div>
          <div>
            <label>Start</label><br>
            <input id="start" type="month">
          </div>
          <div>
            <label>End</label><br>
            <input id="end" type="month">
          </div>
          <button id="plotBtn">Plot</button>
          <div id="err" style="color:#b00020; font-weight:600;"></div>
        </div>

        <div id="word-chart" style="width:100%; height:520px;"></div>
      </div>

      <p>We can clearly see on this graph the steep increase in popularity of Hillary clinton and Donald trump for the 2016 elections.
         Before that, Barack Obama had the lead for the 2008 and 2012 elections. 
      </p>

    <h4>
    The "Zeitgeist" of Tags Beyond personalities, the evolution of video tags provides a timeline of national anxiety. 
    The graph below displays the cumulative prevalence of the top 10 most used tags in the News & Politics category.
    </h4>







      <p style="margin:6px 0 12px 0; color:#444;">
      HOW TO READ THE GRAPH: Each bubble represents a topic. The larger the bubble, the higher percentage of the number of documents in the corpus is about that topic.
      Blue bars represent the overall frequency of each word in the corpus. If no topic is selected, the blue bars of the most frequently used words will be displayed.
      Red bars give the estimated number of times a given term was generated by a given topic.
      The further the bubbles are away from each other, the more different they are.
      The λ slider allows to rank the terms according to term relevance.
      By default, the terms of a topic are ranked in decreasing order according their topic-specific probability ( λ = 1 ). Moving the slider allows to adjust the rank of terms based on relevance for the specific topic.
      </p>



<!--Elles sont ici tes deux colonnes Victoria ;) -->
    <div class="split-section">
        <div class="column">
            <h3>Opinion poll</h3>
            <p>Analysis of the left-wing engagement shows a steady increase in video production during the primaries.</p>
            <div id="issues-chart" style="width:100%; height:600px; margin: 40px 0;"></div>
            <p>Additional insights regarding the Democratic base on YouTube.</p>
        </div>

        <div class="column">
            <h3>YouTube topics</h3>
            <p>On the other side, conservative channels exhibit higher engagement rates per video posted.</p>
            <div id="chart-right" style="width:100%; height:300px;"></div>
            <p>Observations on the Republican content distribution strategy.</p>
        </div>
    </div>


    <div id="issues-chart" style="width:100%; height:600px; margin: 40px 0;"></div>
    <p> Who doesn't love polls? The graph here shows us the topics Americans found most important during the 2010s. </p>
        <p> We can see that the economy was a big worry throughout most of the decade most likely due to the Great Recession and its tough aftershocks. After all, the heart of capitalism must worry about its economy.
           Health and warfare seems to be a big concern, no surprise there as people do  want to be able to live and be able to go to the hospital. Healthcare being privatized is an obvious issue that is constantly being discussed
           Another topic that results high in the polls is education and environment. Climate change and global warming are obviously issues that worry a lot of the population but sensitive topics like how to teach the children (e.g Critical Race Theory)   Less polarizing topics like public spending and government are not as important, seemingly, as they may be too technical for the average Joe and not controversial enough to care. </p>¨
        <p> Now we have looked at the topics that show up in the polls, let us see which ones catch people's attention on Youtube!</p>







    <div id="tags-area-chart" style="width:100%; height:600px; margin: 20px auto;"></div>




      <p>
        The graph above shows the evolution over time of the top 10 most used tags filtered on the selected US channels in their share of total tags. 
        We can see that many tags stay relatively stable in their use but a few vary significantly. 
        Business and economy saw spikes during the years 2008-2009 which were the years of the Great Recession. 
        The tag “elections” spiked in 2016, a lot more than in 2008 or 2012. This was an extremely mediatized and discussed election and therefore the jump makes sense. 
      </p>



</section>

    <!-- Conclusions -->
    <section id="conclusion">
      <h2>Conclusion</h2>
    </section>

    <hr>
  <section id="references">
    <h2>References</h2>
    <ul>
      <li>
        GIF from Giphy (Trump gif): 
        <a href="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExZGg1dmN5bjlzeTR6bjhtMmhvczdjdDZmbXdraDN1cXI5MXlvNmN4ZiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/FbiL9rsmZN3ib2JSGo/giphy.gif">
          https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExZGg1dmN5bjlzeTR6bjhtMmhvczdjdDZmbXdraDN1cXI5MXlvNmN4ZiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/FbiL9rsmZN3ib2JSGo/giphy.gif
        </a>
      </li>
      <li>
        Happy USA GIF on Pinterest (USA woman gif): 
        <a href="https://www.pinterest.com/pin/happy-usa-gif-happy-usa-americanflag-discover-share-gifs--518125132134966989/">
          https://www.pinterest.com/pin/happy-usa-gif-happy-usa-americanflag-discover-share-gifs--518125132134966989/
        </a>
      </li>
      <li>
        USA Today article (with image) (Obama image): 
        <a href="https://eu.usatoday.com/story/gameon/2012/09/21/revealed-obama-pickup-basketball-games-players/1584501/">
          https://eu.usatoday.com/story/gameon/2012/09/21/revealed-obama-pickup-basketball-games-players/1584501/
        </a>
      </li>
      <li>
        NBC News election image (Header image): 
        <a href="https://media-cldnry.s-nbcnews.com/image/upload/t_nbcnews-fp-1200-630,f_auto,q_auto:best/newscms/2020_36/3409729/200903-youtube-election-2x1-al-1238.jpg">
          https://media-cldnry.s-nbcnews.com/image/upload/t_nbcnews-fp-1200-630,f_auto,q_auto:best/newscms/2020_36/3409729/200903-youtube-election-2x1-al-1238.jpg
        </a>
      </li>
    </ul>
  </section>

  </main>

  <footer>
    <a href="https://github.com/epfl-ada/ada-2022-project-vnboys"><img src="/ada-vnboys-website/assets/img/ivon.png" alt="" title="GitHub"></a>
    <div class="link--git">
      <div class="ling--git--item">
        <a href="{{ site.github.owner_url }}">Eugenio <span class="red">I</span>uginiocamp</a>
      </div>
      <div class="ling--git--item">
        <a href="https://github.com/pigglou"> Louis <span class="red">P</span>igglou </a>
      </div>
      <div class="ling--git--item">
        <a href="https://github.com/vickiwarou"> Victoria<span class="red">V</span>ickiwarou</a>
      </div>
      <div class="ling--git--item">
        <a href="https://github.com/plpeter74"> Pierre-Louis <span class="red">P</span>lpeter74</a>
      </div>
      <div class="ling--git--item">
        <a href="https://github.com/aaduval"> Anthonin <span class="red">A</span>aduval</a>
      </div>
    </div>
  </footer>

  <script src="{{ '/assets/js/scale.fix.js' | relative_url }}"></script>

  {% if site.google_analytics %}
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', '{{ site.google_analytics }}', 'auto');
    ga('send', 'pageview');
  </script>
  {% endif %}
 
  <!-- =========================================================
       EXISTING CHARTS (unchanged except for consistency)
       ========================================================= -->

  <script>
    // Initialize the chart
    var chartDom = document.getElementById('sub-chart');
    var myChart = echarts.init(chartDom);

    // Chart configuration
    var option = {
      color: ['#CC0000', '#FF6B6B', '#808080', '#6495ED', '#4169E1'],
      title: {
        text: 'Number of subscriber share by political orientation',
        subtext: 'Total Number of Subscribers: 47,131,000',
        left: 'center'
      },
      tooltip: { trigger: 'item', formatter: '{b}: {c}%' },
      legend: { orient: 'vertical', left: 'left' },
      series: [{
        name: 'Political Orientation',
        type: 'pie',
        radius: '50%',
        data: [
          { value: 11.2, name: 'Right' },
          { value: 1.0, name: 'Lean Right' },
          { value: 39.5, name: 'Center' },
          { value: 29.2, name: 'Lean Left' },
          { value: 19.2, name: 'Left' }
        ],
        emphasis: {
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: 'rgba(0, 0, 0, 0.5)'
          }
        }
      }]
    };

    myChart.setOption(option);
    window.addEventListener('resize', function () { myChart.resize(); });
  </script>

  <script type="text/javascript">
    var mainChartDom = document.getElementById('main');
    var mainPieChart = echarts.init(mainChartDom);

    var dataByYear = {
      2008: [
        { name: 'Right', value: 0 },
        { name: 'Lean Right', value: 7.3 },
        { name: 'Center', value: 66.5 },
        { name: 'Lean left', value: 26.2 },
        { name: 'Left', value: 0 }
      ],
      2012: [
        { name: 'Right', value: 0.4 },
        { name: 'Lean Right', value: 5.7 },
        { name: 'Center', value: 85.5 },
        { name: 'Lean left', value: 6.9 },
        { name: 'Left', value: 1 }
      ],
      2016: [
        { name: 'Right', value: 0.3 },
        { name: 'Lean Right', value: 23.7 },
        { name: 'Center', value: 35.2 },
        { name: 'Lean left', value: 19 },
        { name: 'Left', value: 21.7 }
      ]
    };

    function showYear(year) {
      var option = {
        color: ['#CC0000', '#FF6B6B', '#808080', '#6495ED', '#4169E1'],
        title: {
          text: year.toString(),
          subtext:
            year === 2008 ? '328 videos' :
              year === 2012 ? '7,646 videos' :
                '56,519 videos',
          left: 'center'
        },
        tooltip: { trigger: 'item', formatter: '{b}: {d}%' },
        legend: { orient: 'vertical', left: 'left' },
        series: [{
          type: 'pie',
          radius: '55%',
          data: dataByYear[year],
          label: { formatter: '{b}: {d}%' }
        }]
      };

      mainPieChart.setOption(option, true);
    }

    showYear(2008);
    window.addEventListener('resize', function () { mainPieChart.resize(); });
  </script>

  <script>
    var chartDom = document.getElementById('political_orientation-chart');
    var myChart = echarts.init(chartDom);

    var option = {
      color: ['#CC0000', '#FF6B6B', '#808080', '#6495ED', '#4169E1'],
      title: {
        text: 'Political orientation of select US politics channels',
        subtext: 'Total Number of Channels: 57',
        left: 'center'
      },
      tooltip: { trigger: 'item', formatter: '{b}: {c}%' },
      legend: { orient: 'vertical', left: 'left' },
      series: [{
        name: 'Political Orientation',
        type: 'pie',
        radius: '50%',
        data: [
          { value: 30.5, name: 'Right' },
          { value: 6.8, name: 'Lean Right' },
          { value: 30.5, name: 'Center' },
          { value: 16.9, name: 'Lean Left' },
          { value: 15.3, name: 'Left' }
        ],
        emphasis: {
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: 'rgba(0, 0, 0, 0.5)'
          }
        }
      }]
    };

    myChart.setOption(option);
    window.addEventListener('resize', function () { myChart.resize(); });
  </script>

  <script>
    var chartDom = document.getElementById('video_share-chart');
    var myChart = echarts.init(chartDom);

    var option = {
      color: ['#CC0000', '#FF6B6B', '#808080', '#6495ED', '#4169E1'],
      title: {
        text: 'Video production share by political orientation',
        subtext: 'Total Number of Videos 796,783',
        left: 'center'
      },
      tooltip: { trigger: 'item', formatter: '{b}: {c}%' },
      legend: { orient: 'vertical', left: 'left' },
      series: [{
        name: 'Political Orientation',
        type: 'pie',
        radius: '50%',
        data: [
          { value: 12.2, name: 'Right' },
          { value: 0.3, name: 'Lean Right' },
          { value: 52.8, name: 'Center' },
          { value: 31.3, name: 'Lean Left' },
          { value: 3.4, name: 'Left' }
        ],
        emphasis: {
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: 'rgba(0, 0, 0, 0.5)'
          }
        }
      }]
    };

    myChart.setOption(option);
    window.addEventListener('resize', function () { myChart.resize(); });
  </script>

  <!-- =========================================================
       Issues chart (poll-level) — unchanged path if that's correct for you
       ========================================================= -->
  <script>
    var issuesChartDom = document.getElementById('issues-chart');
    var issuesChart = echarts.init(issuesChartDom);

    fetch('{{ site.baseurl }}/data/pre-process-pools.json')
      .then(r => r.json())
      .then(rawData => runIssuesChart(rawData));

    function runIssuesChart(rawData) {
      const categories = [...new Set(rawData.map(d => d.Category))];

      const adaptedData = rawData.map(d => [
        d.share,        // Value
        d.poll_date,    // Date
        d.Category,     // Category
        d.Category      // Label
      ]);

      const datasetWithFilters = [];
      const seriesList = [];

      categories.forEach(cat => {
        const datasetId = 'dataset_' + cat;

        datasetWithFilters.push({
          id: datasetId,
          fromDatasetId: 'dataset_raw',
          transform: {
            type: 'filter',
            config: { dimension: 'Category', '=': cat }
          }
        });

        seriesList.push({
          type: 'line',
          datasetId: datasetId,
          showSymbol: false,
          name: cat,
          endLabel: {
            show: true,
            formatter: params => params.value[3] + ': ' + (params.value[0] * 100).toFixed(1) + '%'
          },
          labelLayout: { moveOverlap: 'shiftY' },
          emphasis: { focus: 'series' },
          encode: {
            x: 'Date',
            y: 'Value',
            tooltip: ['Value']
          }
        });
      });

      const option = {
        animationDuration: 8000,
        dataset: [{
          id: 'dataset_raw',
          dimensions: ['Value', 'Date', 'Category', 'Label'],
          source: adaptedData
        }, ...datasetWithFilters],
        title: { text: 'Most important issues facing the US (poll by YouGov)' },
        tooltip: {
          trigger: 'axis',
          valueFormatter: v => (v * 100).toFixed(1) + '%'
        },
        xAxis: { type: 'time', name: 'Poll date' },
        yAxis: {
          name: 'Share (%)',
          axisLabel: { formatter: v => (v * 100).toFixed(0) + '%' }
        },
        grid: { right: 160 },
        series: seriesList
      };

      issuesChart.setOption(option);
      window.addEventListener('resize', () => issuesChart.resize());
    }
  </script>

  <!-- =========================================================
       Videos chart — unchanged (uses your axis break logic)
       ========================================================= -->
  <script>
    var GRID_TOP = 120;
    var GRID_BOTTOM = 80;
    var GRID_LEFT = 60;
    var GRID_RIGHT = 60;
    var Y_DATA_ROUND_PRECISION = 0;

    var _breakAreaStyle = {
      expandOnClick: false,
      zigzagZ: 200,
      zigzagAmplitude: 0,
      itemStyle: { borderColor: '#777', opacity: 0 }
    };

    var chartDom = document.getElementById("videos-chart");
    var myChart = echarts.init(chartDom);

    fetch('{{ site.baseurl }}/data/videos-per-month.json')
      .then(r => r.json())
      .then(raw => run(raw))
      .catch(err => console.error("JSON load error:", err));

    function run(raw) {
      var seriesData = raw
        .map(d => [d.date, d.count])
        .sort((a, b) => new Date(a[0]) - new Date(b[0]));

      var option = {
        title: {
          text: 'News & Politics videos posted on YouTube during the covered period',
          subtext: '',
          left: 'center',
          textStyle: { fontSize: 20 },
          subtextStyle: { color: '#175ce5', fontSize: 15, fontWeight: 'bold' }
        },
        tooltip: { trigger: 'axis' },
        legend: {},
        grid: { top: GRID_TOP, bottom: GRID_BOTTOM, left: GRID_LEFT, right: GRID_RIGHT },
        xAxis: [{ type: 'time', splitLine: { show: false }, breakArea: _breakAreaStyle }],
        yAxis: [{ type: 'value', axisTick: { show: true }, breakArea: _breakAreaStyle }],
        series: [{
          type: 'line',
          name: 'Videos per month',
          symbol: 'circle',
          showSymbol: false,
          symbolSize: 5,
          data: seriesData
        }]
      };

      myChart.setOption(option);
      setTimeout(initAxisBreakInteraction, 0);
      window.addEventListener("resize", () => myChart.resize());
    }

    function initAxisBreakInteraction() {
      var _brushingEl = null;

      myChart.on('click', function (params) {
        if (params.name === 'clearAxisBreakBtn') {
          var option = { xAxis: [{ breaks: [] }], yAxis: [{ breaks: [] }] };
          addClearButtonUpdateOption(option, false);
          myChart.setOption(option);
        }
      });

      function addClearButtonUpdateOption(option, show) {
        option.graphic = [{
          elements: [{
            type: 'rect',
            ignore: !show,
            name: 'clearAxisBreakBtn',
            top: 5,
            left: 5,
            shape: { r: 3, width: 70, height: 30 },
            style: { fill: '#eee', stroke: '#999', lineWidth: 1 },
            textContent: { type: 'text', style: { text: 'Reset', fontSize: 15, fontWeight: 'bold' } },
            textConfig: { position: 'inside' }
          }]
        }];
      }

      myChart.getZr().on('mousedown', function (params) {
        _brushingEl = new echarts.graphic.Rect({
          shape: { x: params.offsetX, y: params.offsetY },
          style: { stroke: 'none', fill: '#ccc' },
          ignore: true
        });
        myChart.getZr().add(_brushingEl);
      });

      myChart.getZr().on('mousemove', function (params) {
        if (!_brushingEl) return;
        var initX = _brushingEl.shape.x;
        var initY = _brushingEl.shape.y;
        var currPoint = [params.offsetX, params.offsetY];
        _brushingEl.setShape('width', currPoint[0] - initX);
        _brushingEl.setShape('height', currPoint[1] - initY);
        _brushingEl.ignore = false;
      });

      document.addEventListener('mouseup', function (params) {
        if (!_brushingEl) return;

        var initX = _brushingEl.shape.x;
        var initY = _brushingEl.shape.y;
        var currPoint = [params.offsetX, params.offsetY];

        var xPixelSpan = Math.abs(currPoint[0] - initX);
        var yPixelSpan = Math.abs(currPoint[1] - initY);

        if (xPixelSpan > 2 && yPixelSpan > 2) {
          updateAxisBreak(myChart, [initX, initY], currPoint, xPixelSpan, yPixelSpan);
        }

        myChart.getZr().remove(_brushingEl);
        _brushingEl = null;
      });

      function updateAxisBreak(myChart, initXY, currPoint, xPixelSpan, yPixelSpan) {
        var dataXY0 = myChart.convertFromPixel({ gridIndex: 0 }, initXY);
        var dataXY1 = myChart.convertFromPixel({ gridIndex: 0 }, currPoint);

        function roundXYValue(val) { return +(+val).toFixed(Y_DATA_ROUND_PRECISION); }

        function makeDataRange(v0, v1) {
          var dataRange = [roundXYValue(v0), roundXYValue(v1)];
          if (dataRange[0] > dataRange[1]) dataRange.reverse();
          return dataRange;
        }

        var xDataRange = makeDataRange(dataXY0[0], dataXY1[0]);
        var yDataRange = makeDataRange(dataXY0[1], dataXY1[1]);

        var xySpan = [
          myChart.getWidth() - GRID_LEFT - GRID_RIGHT,
          myChart.getHeight() - GRID_BOTTOM - GRID_TOP
        ];
        var xGapPercentStr = (xPixelSpan / xySpan[0]) * 100 + '%';
        var yGapPercentStr = (yPixelSpan / xySpan[1]) * 100 + '%';

        function makeOption(xGapPercentStr, yGapPercentStr) {
          return {
            xAxis: [{ breaks: [{ start: xDataRange[0], end: xDataRange[1], gap: xGapPercentStr }] }],
            yAxis: [{ breaks: [{ start: yDataRange[0], end: yDataRange[1], gap: yGapPercentStr }] }]
          };
        }

        myChart.setOption(makeOption(xGapPercentStr, yGapPercentStr));
        setTimeout(() => {
          var option = makeOption('80%', '80%');
          addClearButtonUpdateOption(option, true);
          myChart.setOption(option);
        }, 0);
      }
    }
  </script>

  <!-- =========================================================
       Bar chart (static)
       ========================================================= -->
  <script>
    (function () {
      const categories = [
        "News & Politics", "Nonprofits & Activism", "Travel & Events", "Education",
        "People & Blogs", "Science & Technology", "Gaming", "Autos & Vehicles",
        "Howto & Style", "Entertainment", "Film & Animation", "Sports",
        "Pets & Animals", "Comedy", "Music"
      ];

      const values = [
        42.3, 32.3, 28.2, 27.8, 20.9, 20.2, 19.2,
        18.1, 18.1, 18.0, 17.7, 16.7, 16.4, 15.4, 12.0
      ];

      const el = document.getElementById("political-bar-chart");
      if (!el) return;

      const chart = echarts.init(el);

      const option = {
        title: { text: "Proportion of Political Content by Video Category", left: "center" },
        tooltip: {
          trigger: "axis",
          axisPointer: { type: "shadow" },
          formatter: p => `${p[0].name}<br/>${p[0].value}%`
        },
        grid: { left: 60, right: 40, bottom: 120, top: 80 },
        xAxis: { type: "category", data: categories, axisLabel: { rotate: 45, interval: 0 } },
        yAxis: { type: "value", name: "Videos containing political vocabulary (%)", min: 0, max: 100 },
        series: [{
          type: "bar",
          data: values,
          barWidth: "60%",
          label: { show: true, position: "top", formatter: v => `${v.value}%` }
        }]
      };

      chart.setOption(option);
      window.addEventListener("resize", () => chart.resize());
    })();
  </script>

  <!-- =========================================================
       ✅ Word presence interactive chart (FIXED)
       - correct JSON path: /data/word_presence_monthly.json
       - resolves last names via /data/politicians.json
       - auto-fills dates + auto-plot
       ========================================================= -->
  <script>
(async function () {
  const elWords = document.getElementById("words");
  const elStart = document.getElementById("start");
  const elEnd   = document.getElementById("end");
  const elBtn   = document.getElementById("plotBtn");
  const elErr   = document.getElementById("err");
  const elResolved = document.getElementById("resolved");

  const chartDom = document.getElementById("word-chart");
  const chart = echarts.init(chartDom);

  const DATA_URL = '{{ "/data/word_presence_monthly.json" | relative_url }}';

  let rows;

  // ---- helpers ----
  function norm(s) {
    return String(s || "")
      .toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
      .replace(/[^\w\s-]/g, " ")
      .replace(/\s+/g, " ")
      .trim();
  }
  function ymToInt(ym) { const [Y,M] = ym.split("-").map(Number); return Y*100 + M; }
  function inRange(ym, startYm, endYm) {
    const v = ymToInt(ym);
    return v >= ymToInt(startYm) && v <= ymToInt(endYm);
  }
  function parseWords() {
    return elWords.value.split(",").map(s => s.trim()).filter(Boolean).slice(0, 4);
  }

  // ---- build indices from dataset itself (no politicians.json needed) ----
  // Map: lastName -> [fullName1, fullName2, ...] (from dataset words)
  const lastToFull = new Map();
  // popularity: fullName(norm) -> totalCount
  const pop = new Map();
  // original: norm -> original cased full name
  const orig = new Map();

  function buildIndex() {
    for (const r of rows) {
      const full = String(r.word);
      const fullN = norm(full);
      orig.set(fullN, full);

      const c = Number(r.count) || 0;
      pop.set(fullN, (pop.get(fullN) || 0) + c);

      const parts = fullN.split(" ");
      const last = parts[parts.length - 1];
      if (!last) continue;
      if (!lastToFull.has(last)) lastToFull.set(last, []);
      // store norm version, we’ll convert back with orig
      lastToFull.get(last).push(fullN);
    }

    // unique + sort each bucket by popularity desc
    for (const [last, arr] of lastToFull.entries()) {
      const uniq = [...new Set(arr)];
      uniq.sort((a,b) => (pop.get(b)||0) - (pop.get(a)||0));
      lastToFull.set(last, uniq);
    }
  }

  // resolve input tokens to best dataset "word"
  function resolveInputs(inputs, maxPerLast = 1) {
    const resolved = [];
    const mapping = []; // for UI display

    for (const raw of inputs) {
      const q = norm(raw);
      if (!q) continue;

      // 1) exact full-name exists in dataset
      if (orig.has(q)) {
        resolved.push(orig.get(q));
        mapping.push(`${raw} → ${orig.get(q)}`);
        continue;
      }

      // 2) single token: treat as last name, pick most popular full name(s)
      if (!q.includes(" ") && lastToFull.has(q)) {
        const bucket = lastToFull.get(q).slice(0, maxPerLast).map(n => orig.get(n) || n);
        resolved.push(...bucket);
        mapping.push(`${raw} → ${bucket.join(", ")}`);
        continue;
      }

      // 3) fallback: keep raw (will likely be empty)
      resolved.push(raw);
      mapping.push(`${raw} → (no match)`);
    }

    // unique preserve order (case-insensitive)
    const seen = new Set();
    const out = [];
    for (const x of resolved) {
      const k = norm(x);
      if (!seen.has(k)) { seen.add(k); out.push(x); }
    }
    return { words: out, mapping };
  }

  function render() {
    elErr.textContent = "";
    if (elResolved) elResolved.textContent = "";

    const inputs = parseWords();
    if (inputs.length < 3 || inputs.length > 4) {
      elErr.textContent = "Please enter 3–4 names, comma-separated.";
      return;
    }

    const startYM = elStart.value;
    const endYM   = elEnd.value;
    if (!startYM || !endYM) {
      elErr.textContent = "Start and End must be filled.";
      return;
    }

    const { words, mapping } = resolveInputs(inputs, 1);
    if (elResolved) elResolved.textContent = "Resolved: " + mapping.join(" | ");

    // x-axis months in window
    const x = [...new Set(rows
      .map(d => String(d.date))
      .filter(ym => inRange(ym, startYM, endYM))
    )].sort((a,b) => ymToInt(a) - ymToInt(b));

    const series = words.map(w => {
      const wKey = norm(w);
      const mapYMtoShare = new Map(
        rows
          .filter(d => norm(d.word) === wKey)
          .map(d => [String(d.date), Number(d.share)])
      );
      const y = x.map(ym => mapYMtoShare.has(ym) ? mapYMtoShare.get(ym) : null);

      return {
        name: w,
        type: "line",
        showSymbol: false,
        connectNulls: true,
        data: y
      };
    });

    chart.setOption({
      title: { text: "Presence of American personalities in video titles and tags over time", left: "center" },
      tooltip: {
        trigger: "axis",
        valueFormatter: v => (v == null ? "-" : v.toFixed(3) + "%")
      },
      legend: { top: 40 },
      grid: { top: 90, left: 55, right: 30, bottom: 50 },
      xAxis: { type: "category", data: x, name: "Month" },
      yAxis: {
        type: "value",
        name: "Mentions / videos (%)",
        axisLabel: { formatter: v => v.toFixed(2) + "%" }
      },
      series
    }, true);
  }

  // ---- load data + init ----
  try {
    const r = await fetch(DATA_URL);
    if (!r.ok) throw new Error("Cannot load JSON: " + DATA_URL + " (" + r.status + ")");
    rows = await r.json();
    buildIndex();

    // defaults for date inputs
    const allYM = rows.map(d => String(d.date));
    const minYM = allYM.reduce((a,b) => ymToInt(a) < ymToInt(b) ? a : b);
    const maxYM = allYM.reduce((a,b) => ymToInt(a) > ymToInt(b) ? a : b);

    elStart.value = minYM;
    elEnd.value   = maxYM;

    elBtn.addEventListener("click", render);
    window.addEventListener("resize", () => chart.resize());

    render(); // auto plot on load
  } catch (e) {
    elErr.textContent = e.message;
    console.error(e);
  }
})();
</script>

<script>
(async function () {
  const el = document.getElementById("tags-area-chart");
  if (!el) return;

  const chart = echarts.init(el);

  const DATA_URL = '{{ "/data/top10_tags_share_of_voice_yearly.json" | relative_url }}';

  let rows;
  try {
    const r = await fetch(DATA_URL);
    if (!r.ok) throw new Error(`Cannot load JSON: ${DATA_URL} (${r.status})`);
    rows = await r.json();
  } catch (e) {
    console.error(e);
    el.innerHTML = `<p style="color:#b00020;font-weight:600;">${e.message}</p>`;
    return;
  }

  const years = rows.map(d => String(d.year));
  const tags = Object.keys(rows[0]).filter(k => k !== "year");

  // ✅ Matplotlib / seaborn "tab10" palette (same as your screenshot)
  const TAB10 = [
    "#1f77b4", // blue
    "#ff7f0e", // orange
    "#2ca02c", // green
    "#d62728", // red
    "#8c564b", // brown
    "#9467bd", // purple
    "#e377c2", // pink
    "#7f7f7f", // gray
    "#bcbd22", // olive/yellow-green
    "#17becf"  // cyan
  ];

  const series = tags.map((tag, i) => ({
    name: tag,
    type: "line",
    stack: "Total",
    areaStyle: {},
    emphasis: { focus: "series" },
    showSymbol: false,
    data: rows.map(d => Number(d[tag] ?? 0))
  }));

  const option = {
    // ✅ force exact colors like the Python plot
    color: TAB10,

    title: {
      text: "Cumulative prevalence of the top 10 leading political tags over time",
      left: "center"
    },
    tooltip: {
      trigger: "axis",
      axisPointer: {
        type: "cross",
        label: { backgroundColor: "#6a7985" }
      },
      valueFormatter: v => `${Number(v).toFixed(2)}%`
    },
    legend: {
      top: 35,
      data: tags
    },
    grid: { top: 90, left: 60, right: 60, bottom: 60 },
    xAxis: [{
      type: "category",
      boundaryGap: false,
      data: years,
      name: "Year"
    }],
    yAxis: [{
      type: "value",
      name: "Cumulative share of voice (%)",
      axisLabel: { formatter: v => `${v}%` }
    }],
    series
  };

  chart.setOption(option);
  window.addEventListener("resize", () => chart.resize());
})();
</script>











</body>

</html>
